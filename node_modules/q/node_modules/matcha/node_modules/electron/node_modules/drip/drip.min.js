/*!
 * drip - Node.js event emitter.
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */

!function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&typeof define.amd=="object"?define(b):this[a]=b()}("drip",function(){function b(a,b){var c=a.length,d=b.length,e=Array(c+d);for(var f=0;f<c;f++)e[f]=a[f];for(var g=0;g<d;g++)e[f+g]=b[g];return e}function d(a){a&&(this._drip={},this._drip.delimeter=a.delimeter||":",this._drip.wildcard=a.wildcard||(a.delimeter?!0:!1),this._drip.wildcard&&(this.on=f,this.off=h,this.emit=j,this.hasListener=m))}function e(){var a=this._events||(this._events={}),b=arguments[0],c=arguments[1];return a[b]?"function"==typeof a[b]?a[b]=[a[b],c]:a[b].push(c):a[b]=c,this}function f(){function f(a,b){var d=a.shift();b[d]=b[d]||{},a.length?f(a,b[d]):b[d]._?b[d]._.push(c):b[d]._=[c]}var a=this._events||(this._events={}),b=arguments[0],c=arguments[1],d=Array.isArray(b)?b.slice(0):b.split(this._drip.delimeter),e=this._events||(this._events={});return f(d,e),this}function g(a,b){if(!this._events||arguments.length==0)return this._events={},this;if(!b)return this._events[a]=null,this;var c=this._events[a];if(!c)return this;if("function"==typeof c&&c==b)this._events[a]=null;else{for(var d=0;d<c.length;d++)c[d]==b&&c.splice(d,1);c.length===0?this._events[a]=null:c.length===1&&(this._events[a]=c[0])}return this}function h(a,b){if(!this._events||arguments.length===0)return this._events={},this;var c=Array.isArray(a)?a.slice(0):a.split(this._drip.delimeter);if(c.length===1&&!b)return this._events[a]&&(this._events[a]._=null),this;function d(a){for(var b in a)if(a[b]&&b!="_")return!1;return!0}function e(a){if(b&&"function"==typeof b){for(var c=0;c<a._.length;c++)b==a._[c]&&a._.splice(c,1);a._.length===0&&(a._=null),a._&&a._.length==1&&(a._=a._[0])}else a._=null;return!a._&&d(a)&&(a=null),a}function f(a,b){var c=a.shift();return b[c]&&b[c]._&&!a.length&&(b[c]=e(b[c])),b[c]&&a.length&&(b[c]=f(a,b[c])),!b[c]&&d(b)&&(b=null),b}return this._events=f(c,this._events),this}function i(){if(!this._events)return!1;var a=arguments[0],b=this._events[a];if(!b)return!1;if("function"==typeof b)if(arguments.length==1)b.call(this);else if(arguments.length==2)b.call(this,arguments[1]);else if(arguments.length==3)b.call(this,arguments[1],arguments[2]);else{var c=arguments.length,d=Array(c-1);for(var e=1;e<c;e++)d[e-1]=arguments[e];b.apply(this,d)}else{var d;for(var e=0,c=b.length;e<c;e++)if(arguments.length===1)b[e].call(this);else if(arguments.length===2)b[e].call(this,arguments[1]);else if(arguments.length===3)b[e].call(this,arguments[1],arguments[2]);else{if(!d){var c=arguments.length;d=Array(c-1);for(var f=1;f<c;f++)d[f-1]=arguments[f]}b[e].apply(this,d)}}return!0}function j(){if(!this._events)return!1;var a=arguments[0],b=Array.isArray(a)?a.slice(0):a.split(this._drip.delimeter),c=k(b,this._events);if(!c.length)return!1;var d;for(var e=0,f=c.length;e<f;e++)if(arguments.length===1)c[e].call(this);else if(arguments.length===2)c[e].call(this,arguments[1]);else if(arguments.length===3)c[e].call(this,arguments[1],arguments[2]);else{if(!d){var g=arguments.length;d=Array(g-1);for(var h=1;h<g;h++)d[h-1]=arguments[h]}c[e].apply(this,d)}return!0}function k(a,c){var d=a.shift(),e=[];d!=="*"&&c[d]&&c[d]._&&!a.length&&("function"==typeof c[d]._?e.push(c[d]._):e=b(e,c[d]._)),c["*"]&&c["*"]._&&!a.length&&("function"==typeof c["*"]._?e.push(c["*"]._):e=b(e,c["*"]._));if(a.length&&(c[d]||c["*"])){var f=a.length,g=Array(f),h=Array(f);for(var i=0;i<f;i++)g[i]=a[i],h[i]=a[i];if(c[d]){var j=k(g,c[d]);e=b(e,j)}if(c["*"]){var j=k(h,c["*"]);e=b(e,j)}}return e}function l(a,b){if(!this._events)return!1;var c=this._events[a];return c?n(c,b):!1}function m(a,b){if(!this._events)return!1;var c=Array.isArray(a)?a.slice(0):a.split(this._drip.delimeter),d=k(c,this._events);return d.length===0?!1:n(d,b)}function n(a,b){return!b&&"function"==typeof a?!0:b&&"function"==typeof a&&b==a?!0:a.length===0?!1:b&&a.indexOf(b)>-1?!0:b?!1:!0}function o(a,b){var c=this._drip||(this._drip={}),d=c.memoize||(c.memoize={}),e=c.delimeter&&Array.isArray(a)?a.join(c.delimeter):a,f=d[e],g=null;if(!f)g=p(e,b),d[e]=[[b,g]];else{for(var h=0,i=f.length;h<i;h++)if(f[h][0]===b)return f[h][1];g=p(e,b),f.push([b,g])}return g}function p(a,b){return function(){var d=Array.prototype.slice.call(arguments),e=[a].concat(d);b.emit.apply(b,e)}}var a={},c=a.exports=d;return c.version="0.3.0",d.prototype.on=e,d.prototype.addListener=function(){this.on.apply(this,arguments)},d.prototype.many=function(a,b,c){function e(){--b===0&&d.off(a,e),c.apply(null,arguments)}var d=this;return this.on(a,e),this},d.prototype.once=function(a,b){return this.many(a,1,b),this},d.prototype.off=g,d.prototype.removeListener=function(){this.off.apply(this,arguments)},d.prototype.removeAllListeners=function(){this.off.call(this)},d.prototype.emit=i,d.prototype.hasListener=l,d.prototype.bindEvent=function(a,b){return this.on(a,o.call(this,a,b)),this},d.prototype.unbindEvent=function(a,b){return this.off(a,o.call(this,a,b)),this},d.prototype.proxyEvent=function(a,b,c){"string"!=typeof b&&(c=b,b=null);var d=!b||!this._drip.delimeter?a:Array.isArray(b)?b.concat(a):b.split(this._drip.delimeter).concat(a);return c.on(a,o.call(this,d,this)),this},d.prototype.unproxyEvent=function(a,b,c){"string"!=typeof b&&(c=b,b=null);var d=!b||!this._drip.delimeter?a:Array.isArray(b)?b.concat(a):b.split(this._drip.delimeter).concat(a);return c.removeListener(a,o.call(this,d,this)),this},c})